# Config Service
The Configuration Service provides a centralized persistent store for any configuration file used in the TMT Software
System. All versions of configuration files are retained, providing a historical record of each configuration file.
This client exposes simple methods to access and manage configuration files.

## Rules and Checks
1. The config file path must not contain !#<>$%&'@^``~+,;= or any whitespace character
2. If the input file is > 10MB or has lot of non ASCII characters, then for optimization, server will archive it in
annex store.
3. Large and binary files can be forced to go to the ‘annex’ store by using annex=true flag in create operation.

## Model Classes
- ConfigData : Represents the contents of the files being managed. It wraps blob object.
- ConfigFileInfo : Represents information about a config file stored in the Config Service.
- ConfigFileRevision : Represents information about a specific version of a config file.
- ConfigId : Represents an identifier associated with a revision of a configuration file, often generated by create or
update methods.
- ConfigMetadata : Represents metadata information about the Config Server.
- FileType : Represents the type of storage for a configuration file. Currently two types are supported
Normal(small, text files) and Annex(Large, Binary files).

#### Example for creation ConfigData and accessing data with helper function

Typescript
: @@snip [Config-Service](../../../../example/src/documentation/config/ConfigExample.ts) { #config-data }

Note: Models other than ConfigData are simple typescript classes and do not have special helper methods unlike ConfigData.


## Creation of Config Service

### Pre-requisite
#### In order to use config service:
1. The Location Service and Configuration Service Server needs to be running in the network
2. The necessary configuration, environment variables or system properties should be defined to point to the correct
host and port number(s) for the Location Service nodes.
3. Authorization Token with correct access role.
   Documentation on how to fetch access token could be found @ref[here](../aas/csw-aas-js.md).

#### To create a client for Config service
Config service constructor takes `TokenFactory` as input argument.

Typescript
: @@snip [Location-Service](../../../../example/src/documentation/config/ConfigExample.ts) { #config-service }

@@@ note {title="Async-Await" }

Note that the examples are using async/await which makes handling of promises more readable.

@@@

## Usages of Config Service

Type Definitions of API can be found @extref:[here](ts-docs:interfaces/clients.configservice.html)

### create
This API takes `path` at which `configData` needs to be saved in the config service along with meta information i.e
whether to be saved as `annex` or `normal` file and comment. After saving, it returns ConfigId which can be used to
access the saved file in future using query APIs.

Typescript
: @@snip [Config-Service](../../../../example/src/documentation/config/ConfigExample.ts) { #create }

### update
This API takes `path` at which `configData` needs to be updated in the config service along with comment.
After updating, it returns ConfigId which can be used to access the updated file in future using query APIs.

Typescript
: @@snip [Config-Service](../../../../example/src/documentation/config/ConfigExample.ts) { #update }

### getActive
This API takes `path` from which the active `configData` needs to be fetched and returns ConfigData if available.

Typescript
: @@snip [Config-Service](../../../../example/src/documentation/config/ConfigExample.ts) { #get-active }

### getLatest
This API takes `path` from which the latest `configData` needs to be fetched and returns ConfigData if available.

Typescript
: @@snip [Config-Service](../../../../example/src/documentation/config/ConfigExample.ts) { #get-latest }

### getById
This API takes `path` and previously created/updated configuration's `configId` to be fetched and returns ConfigData if
available.

Typescript
: @@snip [Config-Service](../../../../example/src/documentation/config/ConfigExample.ts) { #get-by-id }

### getByTime
This API gets the file at the given path as it existed at a given time-instance.
Note:
-If time-instance is before the file was created, the initial version is returned.
-If time-instance is after the last change, the most recent version is returned.

Typescript
: @@snip [Config-Service](../../../../example/src/documentation/config/ConfigExample.ts) { #get-by-time }

### exists
This API checks whether file exists at the given `path` and optional specific `configId` in the repository and returns
true if it does exist or else false.

Typescript
: @@snip [Config-Service](../../../../example/src/documentation/config/ConfigExample.ts) { #exists }

### delete
This API deletes a file located at specified `path` in the repository.

Typescript
: @@snip [Config-Service](../../../../example/src/documentation/config/ConfigExample.ts) { #delete }

### list
This API list all the files for a given FileType (Annex or Normal) and an optional pattern string, it will list all
files whose path matches the given pattern.

Some pattern examples are: “/path/hcd/*.*”, “a/b/c/d.*”, “.*.conf”, “.*hcd.*”

Typescript
: @@snip [Config-Service](../../../../example/src/documentation/config/ConfigExample.ts) { #list }


### history
This API returns the history of revisions of the file at the given `path` for a range of period specified by `from`
and `to`.

The size of the list can be restricted using `maxResults`.

Typescript
: @@snip [Config-Service](../../../../example/src/documentation/config/ConfigExample.ts) { #history }


### getMetadata
This API used to get metadata information about the Config Service.
It includes:

- repository directory
- annex directory
- min annex file size
- max config file size

Typescript
: @@snip [Config-Service](../../../../example/src/documentation/config/ConfigExample.ts) { #get-metadata }

## Managing active versions
In its lifetime, a config file undergoes many revisions. An active version is a specific revision from a file’s
history and it is set by administrators.

### historyActive
This API returns the history of `active` revisions of the file at the given `path` for a range of period specified by
`from` and `to`.
The size of the list can be restricted using maxResults.

Typescript
: @@snip [Config-Service](../../../../example/src/documentation/config/ConfigExample.ts) { #history-active }

### setActiveVersion
This API sets the "active version" to be the version provided for the file at the given path.
If this method is never called in a config’s lifetime, the active version will always be the version returned by create
function.

Typescript
: @@snip [Config-Service](../../../../example/src/documentation/config/ConfigExample.ts) { #set-active-version }

### resetActiveVersion
This API resets the "active version" of the file at the given path to the latest version.

Typescript
: @@snip [Config-Service](../../../../example/src/documentation/config/ConfigExample.ts) { #reset-active-version }

### getActiveVersion
This API returns the revision ID which represents the "active version" of the file at the given path.

Typescript
: @@snip [Config-Service](../../../../example/src/documentation/config/ConfigExample.ts) { #get-active-version }

### getActiveByTime
This API returns the content of `active` version of the file existed at given instant of `Time`

Typescript
: @@snip [Config-Service](../../../../example/src/documentation/config/ConfigExample.ts) { #get-active-by-time }
